import { prisma } from './prisma'

// Product images from local folder
const localImages = {
  electric1: '/images/products/chr5-min-276x300.jpg',
  electric2: '/images/products/chr6-min-276x300.jpg',
  electric3: '/images/products/chr8-min-276x300.jpg',
  electric4: '/images/products/JUNGHEINRICH-EFG-318K_1.jpg',
  thermal1: '/images/products/250D-9-276x300.jpg',
  thermal2: '/images/products/35DE-7-276x300.jpg',
  thermal3: '/images/products/50DN-9VBTier-3A-276x300.jpg',
  thermal4: '/images/products/Chariot-toyota-Diesel-2.jpg',
}

const fallbackProducts = [
  // Electric Products
  {
    id: '1',
    name: 'Chariots élévateurs à mât rétractable',
    slug: 'chariots-mat-retractable',
    description: 'Dimensions compactes et grande hauteur de levage jusqu\'à 13 mètres. Idéal pour les hangars de stockage et la production.',
    category: 'Électrique',
    image: localImages.electric1,
    features: 'Hauteur jusqu\'à 13m|Dimensions compactes|Très maniable|Stockage',
    order: 0,
  },
  {
    id: '2',
    name: 'Chariots élévateurs frontaux électriques',
    slug: 'chariots-frontaux-electriques',
    description: 'Chariots élévateurs frontaux électriques pour une utilisation intérieure et extérieure.',
    category: 'Électrique',
    image: localImages.electric4,
    features: 'Intérieur/Extérieur|Polyvalent|Électrique|Écologique',
    order: 1,
  },
  {
    id: '3',
    name: 'Transpalettes',
    slug: 'transpalettes',
    description: 'Transpalettes électriques et manuels pour le transport horizontal de palettes. Idéal pour la mise en rayon et les entrepôts étroits.',
    category: 'Électrique',
    image: localImages.electric2,
    features: 'Transport horizontal|Entrepôts étroits|Mise en rayon|Chargement/déchargement',
    order: 2,
  },
  {
    id: '4',
    name: 'Gerbeurs électriques',
    slug: 'gerbeurs-electriques',
    description: 'Gerbeurs électriques performants pour le stockage et la récupération des marchandises. Parfaits pour le picking.',
    category: 'Électrique',
    image: localImages.electric3,
    features: 'Stockage et récupération|Picking|Facile à manipuler|Applications intensives',
    order: 3,
  },
  // Thermal Products
  {
    id: '5',
    name: 'Chariots élévateurs Thermique 25D-9',
    slug: 'chariot-thermique-25d',
    description: 'Chariot élévateur diesel robuste avec capacité de 2.5 tonnes. Idéal pour utilisation en extérieur.',
    category: 'Thermique',
    image: localImages.thermal1,
    features: 'Capacité 2.5T|Utilisation extérieur|Robuste|Diesel',
    order: 4,
  },
  {
    id: '6',
    name: 'Chariots élévateurs Thermique 35D-9',
    slug: 'chariot-thermique-35d',
    description: 'Chariot élévateur diesel avec capacité de 3.5 tonnes. Performance et fiabilité garanties.',
    category: 'Thermique',
    image: localImages.thermal2,
    features: 'Capacité 3.5T|Haute performance|Fiable|Diesel',
    order: 5,
  },
  {
    id: '7',
    name: 'Chariots élévateurs Thermique 50D-9',
    slug: 'chariot-thermique-50d',
    description: 'Chariot élévateur diesel puissant avec capacité de 5 tonnes. Pour charges lourdes.',
    category: 'Thermique',
    image: localImages.thermal3,
    features: 'Capacité 5T|Charges lourdes|Puissant|Diesel',
    order: 6,
  },
  {
    id: '8',
    name: 'Chariots élévateurs Thermique 70D-9',
    slug: 'chariot-thermique-70d',
    description: 'Chariot élévateur diesel haute capacité de 7 tonnes. Pour les applications industrielles intensives.',
    category: 'Thermique',
    image: localImages.thermal4,
    features: 'Capacité 7T|Applications intensives|Industriel|Diesel',
    order: 7,
  },
]

export async function getFeaturedProducts() {
  try {
    const products = await prisma.product.findMany({
      orderBy: { order: 'asc' },
      take: 3,
    })
    if (products.length > 0) {
      return products.map((p) => ({
        ...p,
        image: p.image || fallbackProducts[0]!.image,
      }))
    }
  } catch {
    // Prisma non initialisé ou DB absente
  }
  return fallbackProducts
}

export async function getAllProducts() {
  try {
    const products = await prisma.product.findMany({
      orderBy: [{ order: 'asc' }, { name: 'asc' }],
    })
    if (products.length > 0) return products
  } catch {
    // Fallback
  }
  return fallbackProducts
}

export async function getProductBySlug(slug: string) {
  try {
    const product = await prisma.product.findUnique({
      where: { slug },
    })
    if (product) return product
  } catch {
    // Fallback
  }
  return fallbackProducts.find((p) => p.slug === slug) || null
}

const fallbackPosts = [
  {
    id: '1',
    title: 'Comment choisir la bonne société pour l\'entretien de vos équipements de manutention ?',
    slug: 'choisir-societe-entretien-manutention',
    excerpt: 'Dans le domaine de la manutention, la fiabilité des équipements est primordiale. Découvrez nos conseils pour choisir le bon partenaire.',
    content: '<p>Le choix d\'une société de maintenance pour vos équipements de manutention est crucial pour garantir la sécurité et la productivité de vos opérations.</p><h2>Les critères essentiels</h2><p>Lors de votre sélection, assurez-vous de vérifier l\'expertise technique, les certifications, la disponibilité du service après-vente et la qualité des pièces de rechange utilisées.</p><h2>L\'importance de la réactivité</h2><p>Un bon partenaire doit pouvoir intervenir rapidement en cas de panne pour minimiser les temps d\'arrêt de vos équipements.</p>',
    image: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=800&q=80',
    published: true,
    createdAt: new Date('2024-01-15'),
  },
  {
    id: '2',
    title: 'Louer des chariots supplémentaires lors d\'un pic de saisonnalité',
    slug: 'louer-chariots-pic-saisonnalite',
    excerpt: 'En tant qu\'acteur majeur du secteur de la logistique, vous devez anticiper les périodes de forte activité. Voici comment gérer vos besoins.',
    content: '<p>Les pics de saisonnalité peuvent mettre à rude épreuve votre flotte de chariots élévateurs. La location de chariots supplémentaires est une solution flexible et économique.</p><h2>Avantages de la location</h2><p>La location vous permet d\'adapter votre capacité de manutention sans investissement lourd, tout en bénéficiant d\'équipements récents et bien entretenus.</p><h2>Comment planifier</h2><p>Anticipez vos besoins en analysant les données des années précédentes et contactez votre fournisseur plusieurs semaines à l\'avance.</p>',
    image: 'https://images.unsplash.com/photo-1553413077-190dd305871c?w=800&q=80',
    published: true,
    createdAt: new Date('2024-01-10'),
  },
  {
    id: '3',
    title: 'Optimiser la gestion de sa logistique lors d\'un pic de saisonnalité',
    slug: 'optimiser-logistique-saisonnalite',
    excerpt: 'Lorsqu\'un pic de saisonnalité survient, la gestion de la logistique devient un défi majeur. Découvrez nos stratégies d\'optimisation.',
    content: '<p>Une gestion efficace de la logistique pendant les périodes de forte activité est essentielle pour maintenir la satisfaction client et la rentabilité.</p><h2>Stratégies d\'optimisation</h2><p>Optimisez vos flux en réorganisant votre entrepôt, en formant du personnel temporaire et en utilisant des équipements adaptés à vos besoins spécifiques.</p><h2>L\'importance de l\'anticipation</h2><p>Préparez-vous en amont en renforçant vos stocks, en planifiant les rotations d\'équipes et en vérifiant l\'état de vos équipements de manutention.</p>',
    image: 'https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=800&q=80',
    published: true,
    createdAt: new Date('2024-01-05'),
  },
]

export async function getBlogPosts() {
  try {
    const posts = await prisma.blogPost.findMany({
      where: { published: true },
      orderBy: { createdAt: 'desc' },
    })
    if (posts.length > 0) return posts
  } catch {
    //
  }
  return fallbackPosts
}

export async function getBlogPostBySlug(slug: string) {
  try {
    const post = await prisma.blogPost.findUnique({
      where: { slug, published: true },
    })
    if (post) return post
  } catch {
    //
  }
  return fallbackPosts.find((p) => p.slug === slug) || null
}
